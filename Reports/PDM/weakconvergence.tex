\subsubsection{Weak convergence}

Another relevant feature of stochastic numerical methods is their weak convergence. The following analysis has been carried out in \cite{CGS16}, and we report the main steps in this work. Let us recall the definition of weak order of convergence
\begin{definition} Given the equation \eqref{eq:ODE}, the probabilistic method \eqref{eq:probMethod} is said to have a weak order of convergence $r$ if there exists a constant $C$ such that, for any function $\phi$ sufficiently smooth
	\begin{equation}
	\sup_{t_k = kh} \abs{\E[\phi(U_k)] - \phi(u(t_k))} \leq Ch^r,
	\end{equation}
for $h$ small enough.
\end{definition}
\noindent For the numerical method introduced in \eqref{eq:probMethod}, a result of weak convergence can be proved using a technique of \textit{backward error analysis}. The main idea behind this technique is finding a \textit{modified equation} that the numerical method solves exactly or with a higher accuracy than the original equation. \\
Let us consider \eqref{eq:ODE} and the numerical method \eqref{eq:probMethod}. Using the Lie derivative notation, it is possible to find the differential operators $\mathcal{L}$ and $\diffL^h$ such that for all $\phi \in \mathcal{C}^\infty(\R^d, \R)$ 
\begin{equation}\label{LieNotation}
\begin{aligned}
	\phi(\Phi_h(u)) &= \left(e^{h\diffL} \phi\right)(u), \\
	\E[\phi(U_1 | U_0 = u)] &= \left(e^{h\diffL^h}\phi\right)(u).
\end{aligned}
\end{equation}
In particular, $\diffL = f \cdot \nabla$ and the explicit definition of $\diffL^h$ is not needed in this scope. \\
We now introduced a modified ODE
\begin{equation}\label{modifiedODE}
	\hat u' = f^h(\hat u), 
\end{equation}
and a modified SDE
\begin{equation}\label{modifiedSDE}
	\dd{\tilde u} = f^h{\tilde u}\dd{t} + \sqrt{h^{2p} Q} \dd{W},
\end{equation}
where $p$ has been introduced in Assumption \ref{assumption_1}. We rewrite the solution of these equations in terms of Lie derivatives as for \eqref{LieNotation} introducing the differential operators $\hat \diffL$ and $\tilde \diffL$, \textit{i.e.},
\begin{equation}\label{LieNotationModif}
\begin{aligned}
	\phi\left(\hat u(h) | \hat u(0) = u\right) &= \left(e^{h\hat\diffL^h}\phi\right)(u), \\
	\phi\left(\tilde u(h)|\tilde u(0) = u\right) &= \left(e^{h\tilde\diffL^h}\phi\right)(u).
\end{aligned}
\end{equation}
Therefore,
\begin{equation}
\begin{aligned}
	\hat \diffL^h &= f^h \cdot \nabla, \\
	\tilde \diffL^h &= f^h \cdot \nabla + \frac{1}{2} h^{2p} Q : \nabla^2,
\end{aligned}
\end{equation}
where the scalar product $A : B$ in $\R^{d\times d}$ is defined as $A : B = \tr(A^TB)$. The operator $\tilde \diffL^h$ is the \textit{generator} of \eqref{modifiedSDE}. Introducing the modified equations above, it is possible to study the weak error between the solution of \eqref{eq:ODE} and the numerical solution given by the probabilistic integrator \cite{CGS16}. In particular, this is achievable considering the approximation given by the probabilistic integrator of the solution of the modified SDE \eqref{modifiedSDE}. Let us introduce for completeness the following assumption, needed to prove the result of weak convergence. 
\begin{assumption} \label{assumption_3}The function $f$ in \eqref{eq:ODE} is in $\mathcal C^\infty$ and all its derivatives are uniformly bounded in $\R^n$. Furthermore, $f$ is such that for all functions $\phi$ in $\mathcal C ^\infty(\R^n, \R)$ 
\begin{equation}
\begin{aligned}
	\sup_{u\in\R^n} \left| e^{h\diffL} \phi(u) \right| &\leq (1 + Lh) \sup_{u\in\R^n} \left|\phi(u)\right|, \\
	\sup_{u\in\R^n} \left| e^{h\diffL^h} \phi(u) \right| &\leq (1 + Lh) \sup_{u\in\R^n} \left|\phi(u)\right|, \\
\end{aligned}
\end{equation}
for some $L > 0$.
\end{assumption}
\noindent We can now state the following result of weak convergence.
\begin{theorem}\label{thm:weakorder} Consider the numerical method \eqref{eq:probMethod} and Assumptions \ref{assumption_1}, \ref{assumption_2} and \ref{assumption_3}. Then for any function $\phi$ in $\mathcal{C}^\infty$ endowed with the properties of Assumption \ref{assumption_3},
\begin{equation}
	\abs{\phi(u(T)) - \E[\phi(U_k)]} \leq Kh^{\min\{2p, q\}}, \quad kh = T,
\end{equation}
and 
\begin{equation}
	\abs{\E[\phi(\tilde u(T))] - \E[\phi(U_k)]} \leq Kh^{2p + 1}, \quad kh = T,
\end{equation}
with $u$ and $\tilde u$ solutions of \eqref{eq:ODE} and \eqref{modifiedSDE}.
\end{theorem}
\noindent The proof of this result can be found in \cite{CGS16}. In the following, we will verify numerically the correctness of this result.

\subsubsection{Numerical experiment - Weak convergence}

Let us consider the FitzHug-Nagumo model, defined by the following ODE
\begin{equation}\label{eq:FitzNag}
\begin{aligned}
	x' &= c\left(x - \frac{x^3}{3} + y\right), && x(0) = -1, \\
	y' &= -\frac{1}{c}(x - a + by), && y(0) = 1,
\end{aligned}
\end{equation}
where $a, b, c$ are real parameters with values $a = 0.2$, $b = 0.2$, $c = 3$. We integrate numerically the equation with \eqref{eq:probMethod}, using EE, MP and RK4 as deterministic method up to final time $T = 1$. Therefore, Assumption \ref{assumption_2} holds with $q = 1$, $q = 2$ and $q = 4$ respectively. We consider that Assumption \ref{assumption_1} is verified with $Q = \sigma I$, where $\sigma = 0.5$ and $I$ is the identity matrix. We then consider for each deterministic solver the value of $p$ to be equal to $q$. Therefore, the weak order of convergence of \eqref{eq:probMethod} is equal to the order of the Runge-Kutta integrator. We let $h$ vary in order to verify the order of convergence and consider 500000 repetitions of the trajectory in order to approximate the expectation of the solution and obtain smooth error curves. Furthermore, we consider as function $\phi$ in Theorem \ref{thm:weakorder} to be the Euclidean norm of the solution. In order to compute the error, we use a reference solution computed with RK4 with time step $h = 10^{-7}$, so that the error of the reference solution is negligible. Results (Figure \ref{fig:weakorder}) show that the weak order of convergence of the three considered methods respect the theoretical order predicted in Theorem \ref{thm:weakorder}.

\begin{figure}
\centering
\resizebox{0.6\linewidth}{!}{\input{plots/weakOrder.tikz}}
\caption{Weak order of convergence of \eqref{eq:probMethod} applied to \eqref{eq:FitzNag}.}
\label{fig:weakorder}
\end{figure}